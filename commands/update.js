const _0x442583=_0x9615;(function(_0x4bf3d4,_0x37c36c){const _0x174734=_0x9615,_0x26c2bc=_0x4bf3d4();while(!![]){try{const _0x5736bb=-parseInt(_0x174734(0x103))/0x1+-parseInt(_0x174734(0x157))/0x2+-parseInt(_0x174734(0x13b))/0x3*(parseInt(_0x174734(0x14f))/0x4)+parseInt(_0x174734(0x141))/0x5+-parseInt(_0x174734(0x12c))/0x6*(parseInt(_0x174734(0x155))/0x7)+-parseInt(_0x174734(0x143))/0x8+parseInt(_0x174734(0x10e))/0x9*(parseInt(_0x174734(0x13c))/0xa);if(_0x5736bb===_0x37c36c)break;else _0x26c2bc['push'](_0x26c2bc['shift']());}catch(_0x1149cb){_0x26c2bc['push'](_0x26c2bc['shift']());}}}(_0x2a3d,0x4d604));const {exec}=require(_0x442583(0x129)),fs=require('fs'),path=require(_0x442583(0x102)),https=require(_0x442583(0x131)),settings=require('../settings'),isOwnerOrSudo=require(_0x442583(0x127));function run(_0x57ff1c){return new Promise((_0x331c53,_0x59697e)=>{exec(_0x57ff1c,{'windowsHide':!![]},(_0x548342,_0x3ea988,_0x8df9b7)=>{const _0x3ed59d=_0x9615;if(_0x548342)return _0x59697e(new Error((_0x8df9b7||_0x3ea988||_0x548342[_0x3ed59d(0x110)]||'')[_0x3ed59d(0x12a)]()));_0x331c53((_0x3ea988||'')[_0x3ed59d(0x12a)]());});});}async function hasGitRepo(){const _0x4df19f=_0x442583,_0x3231e5=path[_0x4df19f(0x14b)](process['cwd'](),_0x4df19f(0x15b));if(!fs[_0x4df19f(0x117)](_0x3231e5))return![];try{return await run('git\x20--version'),!![];}catch{return![];}}async function updateViaGit(){const _0x53d4e5=_0x442583,_0x386681=(await run(_0x53d4e5(0x111))['catch'](()=>'unknown'))['trim']();await run(_0x53d4e5(0x11d));const _0x1306d5=(await run(_0x53d4e5(0x101)))['trim'](),_0x1f5cfd=_0x386681===_0x1306d5,_0xdb3062=_0x1f5cfd?'':await run(_0x53d4e5(0x119)+_0x386681+'..'+_0x1306d5)[_0x53d4e5(0x132)](()=>''),_0x18f467=_0x1f5cfd?'':await run(_0x53d4e5(0x118)+_0x386681+'\x20'+_0x1306d5)[_0x53d4e5(0x132)](()=>'');return await run('git\x20reset\x20--hard\x20'+_0x1306d5),await run(_0x53d4e5(0x107)),{'oldRev':_0x386681,'newRev':_0x1306d5,'alreadyUpToDate':_0x1f5cfd,'commits':_0xdb3062,'files':_0x18f467};}function downloadFile(_0x27a74d,_0x6e52b5,_0x17afd4=new Set()){return new Promise((_0x25b7d7,_0x457c13)=>{const _0x2f4dae=_0x9615;try{if(_0x17afd4[_0x2f4dae(0x10b)](_0x27a74d)||_0x17afd4[_0x2f4dae(0xfb)]>0x5)return _0x457c13(new Error('Trop\x20de\x20redirections'));_0x17afd4[_0x2f4dae(0x10d)](_0x27a74d);const _0x326bf1=_0x27a74d[_0x2f4dae(0x151)](_0x2f4dae(0x13e)),_0x2ac82a=_0x326bf1?require(_0x2f4dae(0x131)):require(_0x2f4dae(0xfd)),_0x13c158=_0x2ac82a[_0x2f4dae(0x150)](_0x27a74d,{'headers':{'User-Agent':'KnightBot-Updater/1.0','Accept':_0x2f4dae(0x12e)}},_0x211d66=>{const _0x413a5d=_0x2f4dae;if([0x12d,0x12e,0x12f,0x133,0x134]['includes'](_0x211d66['statusCode'])){const _0x4baa3=_0x211d66[_0x413a5d(0x135)]['location'];if(!_0x4baa3)return _0x457c13(new Error(_0x413a5d(0x153)+_0x211d66[_0x413a5d(0x154)]+_0x413a5d(0x10a)));const _0x263491=new URL(_0x4baa3,_0x27a74d)[_0x413a5d(0x12a)]();return _0x211d66[_0x413a5d(0x11e)](),downloadFile(_0x263491,_0x6e52b5,_0x17afd4)['then'](_0x25b7d7)[_0x413a5d(0x132)](_0x457c13);}if(_0x211d66[_0x413a5d(0x154)]!==0xc8)return _0x457c13(new Error('HTTP\x20'+_0x211d66[_0x413a5d(0x154)]));const _0x288be8=fs[_0x413a5d(0xfe)](_0x6e52b5);_0x211d66[_0x413a5d(0x13a)](_0x288be8),_0x288be8['on'](_0x413a5d(0x144),()=>_0x288be8['close'](_0x25b7d7)),_0x288be8['on'](_0x413a5d(0x121),_0x494307=>{const _0x3c851b=_0x413a5d;try{_0x288be8[_0x3c851b(0x147)](()=>{});}catch{}fs[_0x3c851b(0x146)](_0x6e52b5,()=>_0x457c13(_0x494307));});});_0x13c158['on'](_0x2f4dae(0x121),_0x4e475d=>{const _0x2acefb=_0x2f4dae;fs[_0x2acefb(0x146)](_0x6e52b5,()=>_0x457c13(_0x4e475d));});}catch(_0x15fffd){_0x457c13(_0x15fffd);}});}async function extractZip(_0x3e606b,_0x4bc2af){const _0x501585=_0x442583;if(process[_0x501585(0x15c)]===_0x501585(0x140)){const _0x1de310=_0x501585(0x11a)+_0x3e606b+_0x501585(0x15a)+_0x4bc2af['replace'](/\\/g,'/')+_0x501585(0x133);await run(_0x1de310);return;}try{await run(_0x501585(0x126)),await run(_0x501585(0x11b)+_0x3e606b+_0x501585(0x116)+_0x4bc2af+'\x27');return;}catch{}try{await run('command\x20-v\x207z'),await run(_0x501585(0x137)+_0x3e606b+'\x27\x20-o\x27'+_0x4bc2af+'\x27');return;}catch{}try{await run(_0x501585(0x123)),await run(_0x501585(0x128)+_0x3e606b+_0x501585(0x116)+_0x4bc2af+'\x27');return;}catch{}throw new Error(_0x501585(0x14c));}function _0x2a3d(){const _0x307c1b=['trim','headers','adReply','7z\x20x\x20-y\x20\x27','ownerNumber:\x20\x27','UPDATE_ZIP_URL','pipe','4773qrJKxX','730MRwTRs','npm\x20install\x20--no-audit\x20--no-fund','https://','includes','win32','825960zOACqO','sendMessage','1182824gkeGlX','finish','rmSync','unlink','close','tmp','ðŸ”„\x20Mise\x20Ã \x20jour\x20du\x20bot,\x20veuillez\x20patienterâ€¦','ownerNumber','join','Aucun\x20outil\x20systÃ¨me\x20pour\x20dÃ©zipper\x20trouvÃ©\x20(unzip/7z/busybox).\x20Le\x20mode\x20Git\x20est\x20recommandÃ©\x20sur\x20ce\x20panneau.','writeFileSync','temp','844BDItkp','get','startsWith','node_modules','HTTP\x20','statusCode','7qGQsXQ','env','72186LCoudG','âœ…\x20RedÃ©marrage\x20rÃ©ussi\x0aTapez\x20.ping\x20pour\x20vÃ©rifier\x20la\x20derniÃ¨re\x20version.','map','\x27\x20-DestinationPath\x20\x27','.git','platform','size','tmp/','http','createWriteStream','Aucune\x20URL\x20ZIP\x20configurÃ©e.\x20DÃ©finissez\x20settings.updateZipUrl\x20ou\x20la\x20variable\x20d\x27environnement\x20UPDATE_ZIP_URL.','data','git\x20rev-parse\x20origin/main','path','116971msLtLA','copyFileSync','utf8','exit','git\x20clean\x20-fd','botOwner:\x20\x27','readdirSync','\x20sans\x20Location','has','readFileSync','add','154881TZugvU','âœ…\x20Mise\x20Ã \x20jour\x20terminÃ©e.\x20RedÃ©marrageâ€¦','message','git\x20rev-parse\x20HEAD','cwd','mkdirSync','../settings','âŒ\x20Ã‰chec\x20de\x20la\x20mise\x20Ã \x20jour\x20:\x0a','\x27\x20-d\x20\x27','existsSync','git\x20diff\x20--name-status\x20','git\x20log\x20--pretty=format:\x22%h\x20%s\x20(%an)\x22\x20','powershell\x20-NoProfile\x20-Command\x20\x22Expand-Archive\x20-Path\x20\x27','unzip\x20-o\x20\x27','replace','git\x20fetch\x20--all\x20--prune','resume','exports','âœ…\x20Mise\x20Ã \x20jour\x20terminÃ©e\x20!\x20RedÃ©marrageâ€¦','error','botOwner','busybox\x20unzip\x20-h','lstatSync','Ã‰chec\x20de\x20la\x20mise\x20Ã \x20jour\x20:','command\x20-v\x20unzip','../lib/isOwner','busybox\x20unzip\x20-o\x20\x27','child_process','toString','settings.js','2807394lNHdZb','Seul\x20le\x20propriÃ©taire\x20ou\x20sudo\x20peut\x20utiliser\x20.update','*/*','key','updateZipUrl','https','catch','\x27\x20-Force\x22'];_0x2a3d=function(){return _0x307c1b;};return _0x2a3d();}function copyRecursive(_0x29b7bb,_0x1e4301,_0x48adc8=[],_0x5daecd='',_0x418f8e=[]){const _0x26c04f=_0x442583;if(!fs[_0x26c04f(0x117)](_0x1e4301))fs[_0x26c04f(0x113)](_0x1e4301,{'recursive':!![]});for(const _0xf7dff6 of fs[_0x26c04f(0x109)](_0x29b7bb)){if(_0x48adc8[_0x26c04f(0x13f)](_0xf7dff6))continue;const _0x194d71=path[_0x26c04f(0x14b)](_0x29b7bb,_0xf7dff6),_0x461a67=path[_0x26c04f(0x14b)](_0x1e4301,_0xf7dff6),_0x42bef0=fs[_0x26c04f(0x124)](_0x194d71);if(_0x42bef0['isDirectory']())copyRecursive(_0x194d71,_0x461a67,_0x48adc8,path[_0x26c04f(0x14b)](_0x5daecd,_0xf7dff6),_0x418f8e);else{fs[_0x26c04f(0x104)](_0x194d71,_0x461a67);if(_0x418f8e)_0x418f8e['push'](path[_0x26c04f(0x14b)](_0x5daecd,_0xf7dff6)[_0x26c04f(0x11c)](/\\/g,'/'));}}}function _0x9615(_0x214985,_0x3d1456){_0x214985=_0x214985-0xfb;const _0x2a3d18=_0x2a3d();let _0x961568=_0x2a3d18[_0x214985];return _0x961568;}async function updateViaZip(_0x4aa076,_0x234bd7,_0x2912b9,_0x268190){const _0x3528f6=_0x442583,_0x552d17=(_0x268190||settings[_0x3528f6(0x130)]||process[_0x3528f6(0x156)][_0x3528f6(0x139)]||'')[_0x3528f6(0x134)]();if(!_0x552d17)throw new Error(_0x3528f6(0xff));const _0x65b3ba=path[_0x3528f6(0x14b)](process['cwd'](),_0x3528f6(0x148));if(!fs[_0x3528f6(0x117)](_0x65b3ba))fs[_0x3528f6(0x113)](_0x65b3ba,{'recursive':!![]});const _0x2fe021=path['join'](_0x65b3ba,'update.zip');await downloadFile(_0x552d17,_0x2fe021);const _0x401ca2=path[_0x3528f6(0x14b)](_0x65b3ba,'update_extract');if(fs[_0x3528f6(0x117)](_0x401ca2))fs[_0x3528f6(0x145)](_0x401ca2,{'recursive':!![],'force':!![]});await extractZip(_0x2fe021,_0x401ca2);const [_0x30d4c8]=fs['readdirSync'](_0x401ca2)[_0x3528f6(0x159)](_0x48c9b4=>path['join'](_0x401ca2,_0x48c9b4)),_0x1b088e=fs['existsSync'](_0x30d4c8)&&fs[_0x3528f6(0x124)](_0x30d4c8)['isDirectory']()?_0x30d4c8:_0x401ca2,_0x1c86d7=[_0x3528f6(0x152),_0x3528f6(0x15b),'session','tmp',_0x3528f6(0xfc),_0x3528f6(0x14e),_0x3528f6(0x100),'baileys_store.json'],_0x2bf48f=[];let _0x160aab=null,_0x523cea=null;try{const _0x13eefc=require(_0x3528f6(0x114));_0x160aab=_0x13eefc&&_0x13eefc[_0x3528f6(0x14a)]?String(_0x13eefc[_0x3528f6(0x14a)]):null,_0x523cea=_0x13eefc&&_0x13eefc['botOwner']?String(_0x13eefc[_0x3528f6(0x122)]):null;}catch{}copyRecursive(_0x1b088e,process[_0x3528f6(0x112)](),_0x1c86d7,'',_0x2bf48f);if(_0x160aab)try{const _0x55fd05=path[_0x3528f6(0x14b)](process[_0x3528f6(0x112)](),_0x3528f6(0x12b));if(fs[_0x3528f6(0x117)](_0x55fd05)){let _0x3494ff=fs[_0x3528f6(0x10c)](_0x55fd05,_0x3528f6(0x105));_0x3494ff=_0x3494ff[_0x3528f6(0x11c)](/ownerNumber:\s*'[^']*'/,_0x3528f6(0x138)+_0x160aab+'\x27');if(_0x523cea)_0x3494ff=_0x3494ff[_0x3528f6(0x11c)](/botOwner:\s*'[^']*'/,_0x3528f6(0x108)+_0x523cea+'\x27');fs[_0x3528f6(0x14d)](_0x55fd05,_0x3494ff);}}catch{}try{fs[_0x3528f6(0x145)](_0x401ca2,{'recursive':!![],'force':!![]});}catch{}try{fs[_0x3528f6(0x145)](_0x2fe021,{'force':!![]});}catch{}return{'copiedFiles':_0x2bf48f};}async function restartProcess(_0x4b5492,_0x581a6e,_0xab9927){const _0x100122=_0x442583;try{await _0x4b5492[_0x100122(0x142)](_0x581a6e,{'text':_0x100122(0x120),'contextInfo':{'externalAdReply':settings[_0x100122(0x136)]}},{'quoted':_0xab9927});}catch{}try{await run('pm2\x20restart\x20all');return;}catch{}setTimeout(()=>{const _0x54e3ae=_0x100122;process[_0x54e3ae(0x106)](0x0);},0x1f4);}async function updateCommand(_0x253e34,_0xe411e,_0x1d5914,_0x2f270e){const _0x163ace=_0x442583,_0x46aaca=_0x1d5914[_0x163ace(0x12f)]['participant']||_0x1d5914[_0x163ace(0x12f)]['remoteJid'],_0x263a11=await isOwnerOrSudo(_0x46aaca,_0x253e34,_0xe411e);if(!_0x1d5914['key']['fromMe']&&!_0x263a11){await _0x253e34[_0x163ace(0x142)](_0xe411e,{'text':_0x163ace(0x12d),'contextInfo':{'externalAdReply':settings[_0x163ace(0x136)]}},{'quoted':_0x1d5914});return;}try{await _0x253e34[_0x163ace(0x142)](_0xe411e,{'text':_0x163ace(0x149),'contextInfo':{'externalAdReply':settings[_0x163ace(0x136)]}},{'quoted':_0x1d5914});if(await hasGitRepo()){const {oldRev:_0x248239,newRev:_0x291bed,alreadyUpToDate:_0x5aa376,commits:_0x3a202f,files:_0x289376}=await updateViaGit();await run(_0x163ace(0x13d));}else{const {copiedFiles:_0x2c3fd0}=await updateViaZip(_0x253e34,_0xe411e,_0x1d5914,_0x2f270e);}try{const _0x152c51=require(_0x163ace(0x114))['version']||'';await _0x253e34[_0x163ace(0x142)](_0xe411e,{'text':_0x163ace(0x10f),'contextInfo':{'externalAdReply':settings[_0x163ace(0x136)]}},{'quoted':_0x1d5914});}catch{await _0x253e34['sendMessage'](_0xe411e,{'text':_0x163ace(0x158),'contextInfo':{'externalAdReply':settings[_0x163ace(0x136)]}},{'quoted':_0x1d5914});}await restartProcess(_0x253e34,_0xe411e,_0x1d5914);}catch(_0x535ebb){console[_0x163ace(0x121)](_0x163ace(0x125),_0x535ebb),await _0x253e34[_0x163ace(0x142)](_0xe411e,{'text':_0x163ace(0x115)+String(_0x535ebb[_0x163ace(0x110)]||_0x535ebb),'contextInfo':{'externalAdReply':settings[_0x163ace(0x136)]}},{'quoted':_0x1d5914});}}module[_0x442583(0x11f)]=updateCommand;